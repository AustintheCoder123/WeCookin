<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<link rel="stylesheet" href="../static/style.css">
<link rel="stylesheet" href="style.css">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <div class="popup"> 
        <div class="userPreferences" id="userPrefs">
            <h3>Restrictions</h3>

            <button id="closeButton" onclick="closeSettings()">x</button>
            
            <input type="checkbox" id="glutenFree">
            <label for="glutenFree">Gluten Free</label><br><br>

            <input type="checkbox" id="noDairy">
            <label for="noDairy">No Dairy</label><br><br>

            <input type="checkbox" id="noNuts">
            <label for="noNuts">No Nuts</label><br><br>

            <h3>Allergens</h3>

            <input type="checkbox" id="vegetarian">
            <label for="vegetarian">Vegetarian</label><br><br>

            <input type="checkbox" id="vegan">
            <label for="vegan">Vegan</label><br><br>

            <input type="checkbox" id="halal">
            <label for="halal">Halal</label><br><br>

            <input type="checkbox" id="Kosher">
            <label for="kosher">Kosher</label><br><br>


            
        </div>

    </div>

    <div id="wholePage">
<!-- div for bookmark bar -->
        <div id="bookmarkBar">
            <h2>Bookmarks</h2>
            <div class="bookmarkRecipe">
                <h3 class="savedRecipe" onclick="recipeFromBar()">Borgor bookmarked</h3>
            </div>
        </div>

        <div class="mainRecipePage">
            <!-- This div holds the differently-colored bar at the top of the website, also holds the input bar for restrictions and the settings button -->
            <div class="options">
                <button onclick="saveRecipe()"> Save Recipe</button>
                <input id="restrictionsPrompt" placeholder="Dietary restrictions here!">
                <button onclick="openSettings()">settings</button>
            </div>

            <!-- This div holds all the things related to the main recipe -->
            <div class="recipeBody">
                <h1 id = "mainRecipeName" class="recipeName">Burger</h1>
                <p id = "mainRecipeTime" class="recipeTime">1 hour</p>
                <div id="mainRecipeNutrition">
                    <div id="nutritionItem">
                        <p></p>
                    </div>
                </div>

                <!-- <img src="../static/pngtree-vegan-friendly-label-png-png-image_5698160.png"> -->
                <!-- <img src="../statc/gluten-free-logo-png_seeklogo-530821.png"> -->
                <p id = "mainRecipeDescription">Description</p>
                <p id = "mainRecipeIngredients">Ingredients</p>
                <p id = "mainRecipeInstructions"> Instructions</p>

            </div>

            <!-- the div for the search bar and send button -->
            <div class="textboxDiv">
                <input id="foodPrompt" placeholder="Start making recipes!" >
                <button onclick="createRecipe()">â†‘</button>
            </div>
        </div>
    </div>

</body>

<script>
    console.log("borgor maxing");

    window.currentRecipe;
    window.recipeDict = {};


    async function createRecipe(){
        let foodRecipe = document.getElementById("foodPrompt").value;
        console.log(foodRecipe);
        let restrictions = document.getElementById("restrictionsPrompt").value;
        console.log(restrictions);
        recipe = await pywebview.api.create_recipe(foodRecipe, restrictions);
        window.currentRecipe = recipe;
        setRecipe(recipe);
    }

    function saveRecipe(){
        console.log(window.currentRecipe);
        console.log(window.currentRecipe["name"]);
        console.log(window.recipeDict);

        if (typeof window.recipeDict == "undefined"){
            window.recipeDict = {};
        }

        console.log(window.recipeDict);

        window.recipeDict[window.currentRecipe["name"]] = window.currentRecipe;
        console.log(window.recipeDict);
        newBookmark(currentRecipe);

        pywebview.api.save_recipe(recipeDict);
    }

    function setRecipe(displayRecipe){
        console.log("setting recipe");
        console.log(displayRecipe);
        if(displayRecipe){
            document.getElementById("mainRecipeName").textContent = displayRecipe.name;
            document.getElementById("mainRecipeTime").textContent = displayRecipe.time;
            //let nutrition = displayRecipe.nutrition.cholesterol  + ", "  + displayRecipe.nutrition.sodium + ", "  + displayRecipe.nutrition.servingsPerRecipe + ", "  + displayRecipe.nutrition.totalCalories + ", "  + displayRecipe.nutrition.totalFat + ", "  + displayRecipe.nutrition.saturatedFat + ", "

            // NUTRITION INFORMATION

            let nutrition = displayRecipe.nutrition;
            createNutrientItem("Calories", nutrition.calori)
            createNutrientItem("Cholesterol", nutrition.cholesterol);
            createNutrientItem("Sodium", nutrition.sodium);
            createNutrientItem("Servings", nutrition.servingsPerRecipe);
            createNutrientItem("Fat", nutrition.totalFat);
            createNutrientItem("Saturated fat", nutrition.saturatedFat);





            document.getElementById("mainRecipeDescription").textContent = displayRecipe.desc;
            document.getElementById("mainRecipeIngredients").textContent = displayRecipe.ingredients;
            document.getElementById("mainRecipeInstructions").textContent = displayRecipe.instructions;
        }
    }

    function createNutrientItem(nutrient, value) {
        let nutritionDiv = document.createElement("div");
        let nutritionText = document.createElement("p");

        nutritionText.innerText = nutrient + ": " + value;
        nutritionDiv.className = "nutritionItem";
        //nutritionText.className = "ENTER CLASS NAME UIWRBGIUWRH"

        document.getElementById("mainRecipeNutrition").appendChild(nutritionDiv);
        nutritionDiv.appendChild(nutritionText);

        console.log('this worked')
    }

    function recipeFromBar(name){
        grabbed = window.recipeDict[name];
        setRecipe(grabbed);
    }

    function newBookmark(recipe){
        let bookmarkDiv = document.createElement("div");
        let bookmarkText = document.createElement("h3");
        
        bookmarkText.innerText = recipe.name;
        bookmarkText.className = "savedRecipe";
        bookmarkDiv.className = "bookmarkRecipe";
        
        
        bookmarkDiv.addEventListener('click', function () {
            setRecipe(recipeDict[bookmarkText.innerText]);
        });

        document.getElementById("bookmarkBar").appendChild(bookmarkDiv);
        bookmarkDiv.appendChild(bookmarkText);
    }

    function openSettings(){
        let settings = document.getElementById("userPrefs");
        settings.style.display = "block";
    }
    function closeSettings(){
        let settings = document.getElementById("userPrefs");
        settings.style.display = "none";
    }

    // window.addEventListener("beforeunload", function (val) {
    //     val.preventDefault();

    // });

    window.addEventListener('pywebviewready', async () => {
        console.log("STARTING STARTING STARTING");

        if (pywebview.api.init) {
            await pywebview.api.init();
            console.log("pywebview.api initialized");
        }
        recipeDict = await pywebview.api.load_recipes();

        console.log(recipeDict);

        for (const key in recipeDict){
            newBookmark(recipeDict[key]);
        }
    });


</script>
</html>